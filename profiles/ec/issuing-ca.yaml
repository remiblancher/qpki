# =============================================================================
# ECDSA Issuing CA Certificate Profile
# =============================================================================
#
# Usage: Autorite de certification intermediaire (emettrice)
#
# L'Issuing CA est l'AC qui emet les certificats aux utilisateurs finaux.
# Elle est signee par la Root CA et:
#   - Peut etre en ligne (avec protection HSM recommandee)
#   - Emet tous les certificats end-entity (TLS, email, code signing)
#   - Peut etre revoquee si compromise (contrairement a la Root)
#
# Hierarchie PKI:
#   Root CA (root-ca.yaml)
#     |__ Issuing CA (ce profile)  <- Vous etes ici
#           |__ TLS Server certificates
#           |__ TLS Client certificates
#           |__ Email certificates
#           |__ Code signing certificates
#
# Standards: RFC 5280 (X.509), CA/Browser Forum Baseline Requirements
#
# Exemple d'initialisation:
#   pki init-ca --profile ecdsa/issuing-ca \
#     --cn "ACME Issuing CA" \
#     --org "ACME Industrie" \
#     --country "FR" \
#     --parent /path/to/root-ca
#
# =============================================================================

name: ec/issuing-ca
description: "Issuing CA ECDSA P-256 - online certificate authority"

# -----------------------------------------------------------------------------
# Subject DN (Distinguished Name)
# -----------------------------------------------------------------------------
# Pour une Issuing CA, le DN est fixe dans le profile.
# Doit etre coherent avec la Root CA.
#
subject:
  fixed:
    c: "FR"
    o: "ACME Industrie"
    cn: "ACME Issuing CA"

# -----------------------------------------------------------------------------
# Duree de validite
# -----------------------------------------------------------------------------
# Issuing CA: 10 ans typique.
# Doit etre plus courte que la Root CA mais plus longue que les certificats emis.
#
validity: 3650d               # 10 ans

# -----------------------------------------------------------------------------
# Cle de signature
# -----------------------------------------------------------------------------
# P-256 acceptable pour Issuing CA (bon compromis performance/securite).
# Doit etre egal ou inferieur a la force de la Root CA.
#
# Note: Pour les CA, keyUsage reste dans extensions (keyCertSign, cRLSign)
#
signature:
  algorithms:          # NIST P-256 (secp256r1)
    - ec-p256
  algo_config:
    - scheme: ecdsa
      hash: sha256              # Explicite: SHA-256 pour P-256

# -----------------------------------------------------------------------------
# Chiffrement (non utilise pour CA)
# -----------------------------------------------------------------------------
# encryption: (absent - les CA ne font que signer)

# -----------------------------------------------------------------------------
# Extensions X.509
# -----------------------------------------------------------------------------
extensions:

  # ---------------------------------------------------------------------------
  # Basic Constraints (RFC 5280 S4.2.1.9)
  # ---------------------------------------------------------------------------
  # pathLen=0 signifie que cette CA ne peut PAS signer d'autres CA.
  # Elle ne peut emettre que des certificats end-entity.
  #
  basicConstraints:
    critical: true
    ca: true
    pathLen: 0                # Ne peut PAS signer d'autres CA

  # ---------------------------------------------------------------------------
  # Key Usage (RFC 5280 S4.2.1.3)
  # ---------------------------------------------------------------------------
  # Note: Pour les CA, keyUsage reste dans extensions.
  #
  keyUsage:
    critical: true
    values:
      - keyCertSign           # Signer des certificats
      - cRLSign               # Signer des CRL

  # ---------------------------------------------------------------------------
  # Extended Key Usage - NON RECOMMANDE pour CA
  # ---------------------------------------------------------------------------
  # Les CA ne devraient pas avoir d'EKU (elles heritent de la politique).
  # Si present, limiterait les certificats que cette CA peut emettre.

  # ---------------------------------------------------------------------------
  # Subject Key Identifier (RFC 5280 S4.2.1.2)
  # ---------------------------------------------------------------------------
  # Genere automatiquement. OBLIGATOIRE pour les CA (RFC 5280).
  #
  # subjectKeyIdentifier: auto

  # ---------------------------------------------------------------------------
  # Authority Key Identifier (RFC 5280 S4.2.1.1)
  # ---------------------------------------------------------------------------
  # Copie automatiquement depuis le SKI de la Root CA.
  # OBLIGATOIRE pour tous les certificats non auto-signes (RFC 5280).
  #
  # authorityKeyIdentifier: auto

  # ---------------------------------------------------------------------------
  # Certificate Policies (RFC 5280 S4.2.1.4)
  # ---------------------------------------------------------------------------
  certificatePolicies:
    critical: false
    policies:
      - oid: "1.3.6.1.4.1.99999.1.0.1"  # OID politique Issuing CA
        cps: "https://pki.acme-industrie.fr/cps"
        userNotice: "ACME Industrie Issuing CA Certificate Policy"

  # ---------------------------------------------------------------------------
  # CRL Distribution Points (RFC 5280 S4.2.1.13)
  # ---------------------------------------------------------------------------
  # Pointe vers la CRL de la Root CA (pour revoquer cette Issuing CA).
  #
  crlDistributionPoints:
    urls:
      - "http://crl.acme-industrie.fr/root-ca.crl"

  # ---------------------------------------------------------------------------
  # Authority Information Access (RFC 5280 S4.2.2.1)
  # ---------------------------------------------------------------------------
  authorityInfoAccess:
    caIssuers:
      - "http://pki.acme-industrie.fr/certs/root-ca.crt"
    # OCSP pour Issuing CA est rare mais possible
    # ocsp:
    #   - "http://ocsp.acme-industrie.fr/root"

  # ---------------------------------------------------------------------------
  # Name Constraints (RFC 5280 S4.2.1.10) - Herite de Root CA
  # ---------------------------------------------------------------------------
  # Les contraintes de nom sont generalement definies sur la Root CA.
  # L'Issuing CA herite de ces contraintes.

  # ---------------------------------------------------------------------------
  # Note: Deploiement et operations
  # ---------------------------------------------------------------------------
  # L'Issuing CA peut etre deployee en ligne avec:
  #   - HSM pour la protection de la cle privee
  #   - Haute disponibilite (cluster actif/passif)
  #   - Audit logging de toutes les operations
  #   - Backup regulier de la base de donnees
  #
  # Services associes:
  #   - OCSP Responder: pour verification de revocation en temps reel
  #   - CRL Distribution: publication reguliere des CRL
  #   - Certificate Enrollment: API/Web pour demandes de certificats
