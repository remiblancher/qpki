# Interoperability Matrix - Source of Truth
# Generates: docs/quality/compliance/INTEROP.md
# Command: make quality-docs

metadata:
  title: "Interoperability Matrix"
  description: "Cross-validation testing between QPKI and external implementations"
  last_updated: "2026-02-11"

# External validators
validators:
  - name: OpenSSL
    version: "3.6+"
    url: "https://www.openssl.org/"
    capabilities:
      - "Classical (ECDSA, RSA, Ed25519)"
      - "PQC (ML-DSA, SLH-DSA, ML-KEM)"
    artifacts:
      - type: Certificate
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-OSL-CERT-001, TC-C-OSL-CERT-002]
      - type: CRL
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-OSL-CRL-001]
      - type: CSR
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-OSL-CSR-001]
      - type: CMS SignedData
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-OSL-CMS-001]
      - type: CMS EnvelopedData
        algorithms: [ECDH, ML-KEM]
        status: pass
        tc_ids: [TC-C-OSL-CMSENC-001]
      - type: OCSP
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-OSL-OCSP-001]
      - type: TSA
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-OSL-TSA-001]
      - type: Catalyst Hybrid
        status: partial
        notes: "Classical signature only (PQC alternative ignored)"
        tc_ids: []
      - type: Composite
        status: not_supported
        notes: "No composite support in OpenSSL"
        tc_ids: []
    test_directory: test/openssl/
    test_command: make crosstest-openssl

  - name: BouncyCastle
    version: "1.83+"
    url: "https://www.bouncycastle.org/"
    capabilities:
      - "Classical (ECDSA, RSA, Ed25519)"
      - "PQC (ML-DSA, SLH-DSA, ML-KEM)"
      - "Catalyst hybrid"
      - "Composite (draft-07)"
    artifacts:
      - type: Certificate
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-BC-CERT-001, TC-C-BC-CERT-002]
      - type: CRL
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-BC-CRL-001]
      - type: CSR
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-BC-CSR-001]
      - type: CMS SignedData
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-BC-CMS-001]
      - type: CMS EnvelopedData
        algorithms: [ECDH, RSA, ML-KEM]
        status: pass
        tc_ids: [TC-C-BC-CMSENC-001]
      - type: OCSP
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-BC-OCSP-001]
      - type: TSA
        algorithms: [Classical, ML-DSA, SLH-DSA]
        status: pass
        tc_ids: [TC-C-BC-TSA-001]
      - type: Catalyst Hybrid
        status: pass
        notes: "Both classical and PQC signatures validated"
        tc_ids: [TC-C-BC-CERT-003, TC-C-BC-CRL-002]
      - type: Composite
        status: partial
        notes: "OID mismatch: BC uses draft-07 (2.16.840.1.114027.80.8.1.x), QPKI uses draft-13 (1.3.6.1.5.5.7.6.x)"
        tc_ids: [TC-C-BC-CERT-004, TC-C-BC-CRL-003]
    test_directory: test/bouncycastle/
    test_command: make crosstest-bc

# Known limitations
limitations:
  - feature: Composite signatures
    status: partial
    details: "BC 1.83 uses draft-07 OIDs (2.16.840.1.114027.80.8.1.x), QPKI uses draft-13 (1.3.6.1.5.5.7.6.x)"
  - feature: Catalyst in OpenSSL
    status: partial
    details: "Only ECDSA signature verified, PQC alternative signature ignored"
  - feature: CMS Encryption ML-KEM
    status: full
    details: "OpenSSL 3.6+ and BC 1.83+ full support"

# CI jobs
ci_jobs:
  - name: test
    tc_pattern: "TC-U-*, TC-F-*"
    scripts: "*_test.go"
    duration: "~15 min"
  - name: crosstest-openssl
    tc_pattern: "TC-C-OSL-*"
    scripts: "test/openssl/verify_*.sh"
    duration: "~30 min"
  - name: crosstest-bc
    tc_pattern: "TC-C-BC-*"
    scripts: "test/bouncycastle/src/test/java/*Test.java"
    duration: "~15 min"
  - name: fuzz
    tc_pattern: "TC-Z-*"
    scripts: "*_fuzz_test.go"
    duration: "~30 min"

# OpenSSL test scripts
openssl_scripts:
  orchestrator: run_all.sh
  library_path: lib/
  scripts:
    - name: verify_certs.sh
      tc_ids: [TC-C-OSL-CERT-001, TC-C-OSL-CERT-002]
      description: "Certificate verification (EC, ML, SLH)"
    - name: verify_crl.sh
      tc_ids: [TC-C-OSL-CRL-001]
      description: "CRL verification"
    - name: verify_csr.sh
      tc_ids: [TC-C-OSL-CSR-001]
      description: "CSR verification"
    - name: verify_cms.sh
      tc_ids: [TC-C-OSL-CMS-001]
      description: "CMS SignedData"
    - name: verify_cms_encrypt.sh
      tc_ids: [TC-C-OSL-CMSENC-001]
      description: "CMS EnvelopedData (ECDH, ML-KEM)"
    - name: verify_ocsp.sh
      tc_ids: [TC-C-OSL-OCSP-001]
      description: "OCSP responses"
    - name: verify_tsa.sh
      tc_ids: [TC-C-OSL-TSA-001]
      description: "TSA timestamps"

# BouncyCastle test classes
bouncycastle_classes:
  package: pki.crosstest
  maven_path: src/test/java/pki/crosstest/
  classes:
    - name: ClassicalVerifyTest.java
      tc_ids: [TC-C-BC-CERT-001]
      description: "ECDSA certificate verification"
    - name: PQCVerifyTest.java
      tc_ids: [TC-C-BC-CERT-002]
      description: "ML-DSA, SLH-DSA verification"
    - name: CatalystVerifyTest.java
      tc_ids: [TC-C-BC-CERT-003]
      description: "Catalyst hybrid certificate"
    - name: CompositeVerifyTest.java
      tc_ids: [TC-C-BC-CERT-004]
      description: "Composite hybrid certificate"
    - name: CRLVerifyTest.java
      tc_ids: [TC-C-BC-CRL-001, TC-C-BC-CRL-002, TC-C-BC-CRL-003]
      description: "CRL verification (standard, Catalyst, Composite)"
    - name: CSRVerifyTest.java
      tc_ids: [TC-C-BC-CSR-001]
      description: "CSR signature verification"
    - name: CMSVerifyTest.java
      tc_ids: [TC-C-BC-CMS-001]
      description: "CMS signed data verification"
    - name: CMSEnvelopedTest.java
      tc_ids: [TC-C-BC-CMSENC-001]
      description: "CMS EnvelopedData/AuthEnvelopedData"
    - name: OCSPVerifyTest.java
      tc_ids: [TC-C-BC-OCSP-001]
      description: "OCSP response verification"
    - name: TSAVerifyTest.java
      tc_ids: [TC-C-BC-TSA-001]
      description: "Timestamp verification"
    - name: ExtensionsVerifyTest.java
      tc_ids: [TC-C-BC-CERT-005]
      description: "X.509 extension parsing"
